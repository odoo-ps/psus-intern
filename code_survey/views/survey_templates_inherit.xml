<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="question_test_button" name="Question: Test Button">
        <div class="text-right">
            <span class="font-weight-bold text-muted ml-2 d-none d-md-inline">Test your code</span>
            <button type='test' class="btn btn-primary">Test</button>
        </div>
    </template>

    <template id="question_code_box" name="Question: code box">
        <textarea is="highlighted-code" language="python" t-att-name="question.id" rows="3"
            t-att-data-question-type="question.question_type"><t t-if="question.function_template != '' and not isTest and not answer_lines" 
            t-esc="question.function_template"/><t t-if="isTest" t-out="valueTextArea"/><t t-if="answer_lines"
            t-esc="answer_lines[0].value_code_box or None"/></textarea>
    </template>

    <template id="survey_fill_form_in_progress_inherit" inherit_id="survey.survey_fill_form_in_progress" name="Survey: form with questions inherit">
        <!-- One page per question -->
        <xpath expr="//div/input[@type='hidden']" position="after">
            <t t-if="question.question_type == 'code_box'"><t t-call="code_survey.question_test_button"/></t>
        </xpath>
        <!-- One Page for all questions -->
        <xpath expr="//t[1]/t[@t-foreach='survey.question_and_page_ids']/div[@t-field='question.description']" position="after">
            <t t-if="question.question_type == 'code_box'">
                <t t-call="code_survey.question_test_button"/>
            </t>
        </xpath>

        <!-- page per section -->
        <xpath expr="//t[2]/t[@t-foreach='page.question_ids']/t[@t-if='question in answer.predefined_question_ids']" position="before">
            <t t-if="question.question_type == 'code_box'">
                <t t-call="code_survey.question_test_button"/>
            </t>
        </xpath>
    </template>
    
    <template id="question_container_inherit" inherit_id="survey.question_container" name="Question Container Inherit">
        <t t-if="question.question_type == 'matrix'" position="after">
            <t t-if="question.question_type == 'code_box'"><t t-call="code_survey.question_code_box"/></t>
            <div t-att-class="'o_survey_question_success overflow-hidden border-0 py-0 px-3 alert alert-success %s' % ('slide_in' if isTest else '')" role="alert">
                <p t-out="question.value_test_code"></p>
            </div>
        </t>    
    </template>
</odoo>
